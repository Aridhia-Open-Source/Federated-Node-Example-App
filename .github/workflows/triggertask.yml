name: Update Task
run-name: update_task
on:
  push:
    branches:
      - pipe-test

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          ref: test-merge
          token: ${{ secrets.SA_TOKEN }}
      - name: Update values
        run: |
          AUTHOR=$(gh pr list -B main --state merged --json author,mergedAt,mergedBy,headRefName,number | jq '.[0].author.login')
          git config --global user.name 'BotMan'
          git config --global user.email 'r-casula@users.noreply.github.com'
          git commit -am "Added user info"
          git push
          cat argo/task.json | jq '.spec.user |= .+ {"username": "$AUTHOR"}'
